<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{requestmodule/fragments/header :: header(datatables = true)}"></head>
<body class="top-navigation layout-fixed">
<div id="wrapper">
	<div id="page-wrapper" class="gray-bg">
		<div th:replace="~{requestmodule/fragments/topbar :: topbar(page = 'myRequests')}"></div>
		<div class="wrapper wrapper-content">
			<div class="row">
				<div class="col-lg-12">
					<div class="ibox">
						<div class="ibox-title">
							<h3>
								<em class="fa fa-list"></em> &nbsp
								<span th:text="#{requestmodule.html.myrequests.title}"></span>
							</h3>
						</div>

						<div class="ibox-content">

							<div class="table-responsive">
								<table id="pendingRequestTable" style="padding-right:0px !important;"
									   class="table table-striped table-bordered table-hover">
									<thead>
									<tr>
										<th></th>
										<th th:text="#{requestmodule.html.myrequests.groups.date}"></th>
										<th th:text="#{requestmodule.html.myrequests.groups.action}"></th>
										<th th:text="#{requestmodule.html.myrequests.groups.reciever}"></th>
										<th th:text="#{requestmodule.html.myrequests.groups.contains}"></th>
										<th th:text="#{requestmodule.html.myrequests.groups.status}"></th>
										<th hidden></th>
									</tr>
									</thead>

									<tbody>
									<tr th:each="requestGroup : ${pendingRequestGroups}">
										<td class="dt-control"></td>
										<td th:text="${#dates.format(requestGroup.requestDate, 'dd-MM-yyyy')}"></td>
										<td th:text="#{${requestGroup.action}}"></td>
										<td th:text="${requestGroup.recieverName}"></td>
										<td th:text="${requestGroup.userroleCount + ' jobfunktionsroller, '+ requestGroup.rolegroupCount + ' rollebuketter'}"></td>
										<td th:text="#{${requestGroup.status}}"></td>
										<!-- Detailview for row-->
										<td hidden class="detailview">
											<table style="width:100%;">
												<thead>
												<tr>
													<th>It-System</th>
													<th>Rollenavn</th>
													<th>Anmodningstype</th>
													<th>Status</th>
													<th th:text="#{html.control.operations}" style="width: 160px;"></th>
												</tr>
												</thead>
												<tbody>
												<tr th:each="request : ${requestGroup.requests}"
													data-request-id="${request.id}">
													<td class="col-sm-2" th:text="${request.itSystemName}"></td>
													<td  th:text="${request.roleName}"></td>
													<td class="col-sm-2" th:text="#{${request.action}}"></td>
													<td class="col-sm-2" th:text="#{${request.status}}"></td>
													<td style="width: 160px;">
														<button th:if="${request.cancelable}" class="btn btn-danger"
																th:text="#{requestmodule.html.cancelRequest}"
																th:attr="onclick='requestService.onRequestCancel('+${request.id}+');'"></button>
													</td>
												</tr>
												</tbody>
											</table>
										</td>
									</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div th:replace="~{requestmodule/fragments/footer :: scripts(datatables = true)}"></div>
<script th:src="@{/js/rolerequest/myrequests/myrequests.js}"></script>

<script th:inline="javascript">
	/*<![CDATA[*/
	/*[+
		const token = $("meta[name='_csrf']").attr("content");
		const uiUrl = [[@{/ui/request/myrequests}]];
		const restUrl = [[@{/rest/rolerequest}]];
		let requestService, dataTableService
	+]*/


	$(document).ready(function(){
		requestService = new RequestService()
		dataTableService = new DataTableService()
	});

	/*]]>*/
</script>

</body>
</html>
