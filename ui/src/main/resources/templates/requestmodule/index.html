<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{requestmodule/fragments/header :: header(datatables = true)}"></head>
<body class="top-navigation layout-fixed">
<div id="wrapper">
	<div id="page-wrapper" class="gray-bg">
		<div th:replace="~{requestmodule/fragments/topbar :: topbar(page = 'dashboard')}"></div>
		<div class="wrapper wrapper-content">
			<div class="row">
				<div class="col-lg-12">
					<div class="ibox">
						<div class="ibox-title">
							<h3>
								<em class="fa fa-list"></em> &nbsp
								<span th:text="#{requestmodule.html.dashboard.title}"></span>
							</h3>

							<div class="ibox-tools">
								<a class="btn btn-primary" style="color: white"
								   th:text="#{requestmodule.html.dashboard.request}"
								   th:href="@{/ui/request/wizard}"></a>
							</div>
						</div>

						<div class="ibox-content">
							<div class="tabs-container" id="tabs">
								<ul class="nav nav-tabs" role="tablist">
									<li>
										<a class="nav-link" data-toggle="tab" href="#userRoleTab"
										   th:text="#{requestmodule.html.dashboard.tabs.userRoles}"></a>
									</li>
									<li>
										<a class="nav-link active" data-toggle="tab" href="#roleGroupsTab"
										   th:text="#{requestmodule.html.dashboard.tabs.roleGroups}"></a>
									</li>
								</ul>
								<div class="tab-content">
									<div role="tabpanel" id="roleGroupsTab" class="tab-pane active">
										<div class="panel-body">
											<div class="table-responsive">
												<table id="roleGroupTable" style="padding-right:0px !important;"
													   class="table table-striped table-bordered table-hover">
													<thead>
													<tr>
														<th style="display: none"></th>
														<th></th>
														<th th:text="#{requestmodule.html.dashboard.tabs.roles.name}"></th>
														<th th:text="#{requestmodule.html.dashboard.tabs.roles.description}"></th>
														<th th:text="#{requestmodule.html.dashboard.tabs.roles.status}"></th>
														<th th:text="#{html.control.operations}"
															style="width: 160px;"></th>
													</tr>
													</thead>

													<tbody>
													<!--rolegroups-->
													<tr th:each="roleGroup : ${roleGroups}">
														<td style="display: none" th:text="${roleGroup.id}"></td>
														<td class="dt-control"></td>
														<td th:text="${roleGroup.name}"></td>
														<td th:text="${roleGroup.description}"></td>
														<td>
															<span th:text="#{${roleGroup.status}}"></span>
															<span
																th:if="${roleGroup.assignedThroughName != null AND roleGroup.assignedThroughName != ''}"
																th:text="'(' + ${roleGroup.assignedThroughName} + ')'"></span>
															<span th:if="${roleGroup.pendingRemoval}"
																  th:text="' - '+ #{requestmodule.html.pending.remove}"></span>
														</td>
														<td>
															<button th:if="${roleGroup.removable}"
																	class="btn btn-danger"
																	th:text="#{requestmodule.html.requestRemoval}"
																	th:attr="onclick='roleGroupService.onRoleGroupRemoval('+${roleGroup.assignmentId}+');'"></button>
														</td>
													</tr>
													<!--pending rolegroup requests-->
													<tr th:each="roleGroup : ${pendingRolegroups}">
														<td style="display: none" th:text="${roleGroup.roleId}"></td>
														<td class="dt-control"></td>
														<td th:text="${roleGroup.name}"></td>
														<td th:text="${roleGroup.description}"></td>
														<td>
															<span th:text="#{${roleGroup.status}}"></span>
														</td>
														<td>
															<button th:if="${roleGroup.cancelable}"
																	class="btn btn-danger"
																	th:text="#{requestmodule.html.cancelRequest}"
																	th:attr="onclick='requestService.onRequestCancel('+${roleGroup.requestId}+');'"></button>
														</td>
													</tr>
													</tbody>
												</table>
											</div>
										</div>
									</div>
									<div role="tabpanel" id="userRoleTab" class="tab-pane">
										<div class="panel-body">
											<table id="userRoleTable"
												   class="table table-striped table-bordered table-hover">
												<thead>
												<tr>
													<th th:text="#{requestmodule.html.dashboard.tabs.roles.itsystem}"></th>
													<th th:text="#{requestmodule.html.dashboard.tabs.roles.role}"></th>
													<th th:text="#{requestmodule.html.dashboard.tabs.roles.description}"></th>
													<th th:text="#{requestmodule.html.dashboard.tabs.roles.status}"></th>
													<th th:text="#{html.control.operations}" style="width: 160px;"></th>
												</tr>
												</thead>

												<tbody>
												<!--												userroles-->
												<tr th:each="userRole : ${userRoles}">
													<td th:text="${userRole.itSystemName}"></td>
													<td th:text="${userRole.name}"></td>
													<td th:text="${userRole.description}"></td>
													<td>
														<span th:text="#{${userRole.status}}"></span>
														<span
															th:if="${userRole.assignedThroughName != null AND userRole.assignedThroughName != ''}"
															th:text="'(' + ${userRole.assignedThroughName} + ')'"></span>
														<span th:if="${userRole.pendingRemoval}"
															  th:text="' - '+ #{requestmodule.html.pending.remove}"></span>
													</td>
													<td>
														<button th:if="${userRole.removable}" class="btn btn-danger"
																th:text="#{requestmodule.html.requestRemoval}"
																th:attr="onclick='userRoleService.onUserRoleRemoval('+${userRole.assignmentId}+');'"></button>
													</td>
												</tr>
												<!--												Pending userrole requests-->
												<tr th:each="userRole : ${pendingUserRoles}">
													<td th:text="${userRole.itSystemName}"></td>
													<td th:text="${userRole.name}"></td>
													<td th:text="${userRole.description}"></td>
													<td>
														<span th:text="#{${userRole.status}}"></span>
													</td>
													<td>
														<button th:if="${userRole.cancelable}" class="btn btn-danger"
																th:text="#{requestmodule.html.cancelRequest}"
																th:attr="onclick='requestService.onRequestCancel('+${userRole.requestId}+');'"></button>
													</td>
												</tr>
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div th:replace="~{requestmodule/fragments/request_removal_modal :: requestRemovalModal}"></div>
<div th:replace="~{requestmodule/fragments/footer :: scripts(datatables = true)}"></div>
<script th:src="@{/js/rolerequest/index.js}"></script>

<script th:inline="javascript">
	/*<![CDATA[*/
	/*[+
		const detailsUrl = [[@{/ui/request/rolegroups}]];
		const restUrl = [[@{/rest/rolerequest}]];
		const token = $("meta[name='_csrf']").attr("content");
		const reasonRequirement = [[${reasonRequirement}]];
		let tabService
	+]*/

	var roleGroupService, userRoleService, expandableRoleGroupTableService, requestService;
	$(document).ready(function(){
		roleGroupService = new RoleGroupService();
		roleGroupService.init();

		userRoleService = new UserRoleService();
		userRoleService.init();

		requestService = new RequestService()

		expandableRoleGroupTableService = new ExpandableRoleGroupTableService();

		tabService = new TabService('rolerequest_my_rights')
		tabService.restoreTab()

		const navLinks = document.querySelectorAll('a.nav-link')
		for (const link of navLinks) {
			link.addEventListener('click', ()=> tabService.rememberTab(link.href.split('#')[1] ))
		}

	});

	/*]]>*/
</script>

</body>
</html>
